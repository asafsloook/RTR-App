<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>mywebsite</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

    <script src="AjaxCalls.js"></script>

    <script>

        dayChoose = "כל יום";
        dateChoose = "תאריך";
        shiftChoose = "כיוון";
        areaChoose = "איזור";
        startChoose = "מוצא";
        endChoose = "יעד";

        //get the rides list on load
        $(document).ready(function () {
            getRidesList();
        });

        //call the ajax function to import the rides list
        function getRidesList() {
            var request = {
                test: "",
            }
            GetRides(request, successCB, errorCB);
        }

        //-----------------------------------------------------------------------------
        // A Method for presenting the results, called on success
        //-----------------------------------------------------------------------------
        function successCB(resutls) {
            resutls = $.parseJSON(resutls.d)

            str = "";
            for (var i = 0; i < resutls.length; i++) {

                var myDate = new Date(parseInt(resutls[i].DateTime.replace('/Date(', '')));

                var day = numToDayHebrew(myDate.getDay());

                if (shiftChoose != "כיוון" && shiftChoose != resutls[i].Shift) {
                    continue;
                }
                if (dayChoose != "כל יום" && dayChoose != day) {
                    continue;
                }
                if (dateChoose != "תאריך" && dateChoose != myDate.toLocaleDateString()) {
                    continue;
                }
                if (areaChoose != "איזור" && areaChoose != resutls[i].Area) {
                    continue;
                }
                if (startChoose != "מוצא" && startChoose != resutls[i].StartPoint) {
                    continue;
                }
                if (endChoose != "יעד" && endChoose != resutls[i].EndPoint) {
                    continue;
                }

                str += '<li><a>'
                    + '<p>יום ' + day
                    + ', ' + myDate.getDate() + "/" + (myDate.getMonth() + 1) + "/" + myDate.getFullYear()
                    + ', ' + myDate.toTimeString().replace(/.*?(\d{2}:\d{2}).*/, "$1") + '</p>'
                    + '<p>מ-' + resutls[i].StartPoint + ' '
                    + 'ל-' + resutls[i].EndPoint + ', '
                    + '' + resutls[i].Person + '</p>'
                    + "</a></li> ";

            }

            $("#pTarget").html(str);
            $("#pTarget").listview("refresh");
        }

        //-----------------------------------------------------------------------------
        // A Method for presenting the error, called on error
        //-----------------------------------------------------------------------------
        function errorCB(e) {
            alert("I caught the exception : failed in someAjaxFunc \n The exception message is : " + e.responseText);
        }

        //function for converting num of day to hebrew day
        function numToDayHebrew(i) {
            var day = "";
            switch (i) {
                case 0:
                    day = "א";
                    break;
                case 1:
                    day = "ב";
                    break;
                case 2:
                    day = "ג";
                    break;
                case 3:
                    day = "ד";
                    break;
                case 4:
                    day = "ה";
                    break;
                case 5:
                    day = "ו";
                    break;
                case 6:
                    day = "ש";
            }
            return day;
        }

        //fill the date ddl dynamicly
        $(document).ready(function () {
            var str = "<option>תאריך</option>";
            for (var i = 0; i < 30; i++) {

                var nowDate = new Date();
                var date = new Date(nowDate.setDate(nowDate.getDate() + i));

                str += "<option>" + date.toLocaleDateString() + "</option>";
            }

            $('#dateDDL').html(str);
            $("#dateDDL").selectmenu("refresh");

        });


        //handle the filter events
        //////////////////////////
        $(document).ready(function () {
            $('#dayDDL').change(function () {
                dayChoose = $('#dayDDL').val();
                getRidesList();
            });
        });


        $(document).ready(function () {
            $('#dateDDL').change(function () {
                dateChoose = $('#dateDDL').val();
                getRidesList();
            });
        });

        $(document).ready(function () {
            $('#shiftDDL').change(function () {
                shiftChoose = $('#shiftDDL').val();
                getRidesList();
            });
        });

        $(document).ready(function () {
            $('#areaDDL').change(function () {
                areaChoose = $('#areaDDL').val();
                getRidesList();
            });
        });

        $(document).ready(function () {
            $('#startDDL').change(function () {
                startChoose = $('#startDDL').val();
                getRidesList();
            });
        });

        $(document).ready(function () {
            $('#endDDL').change(function () {
                endChoose = $('#endDDL').val();
                getRidesList();
            });
        });
    </script>

    <style>


        .ui-listview > .ui-li-static, .ui-listview > .ui-li-divider, .ui-listview > li > a.ui-btn {
            text-align: right;
            font-size: 25px;
        }

        fieldset {
            text-align: center;
        }
    </style>
</head>
<body>

    <div data-role="page" id="main">

        <div data-role="header" data-theme="b">
            <h1>בדרך להחלמה</h1>
        </div>


        <div data-role="content">

            <fieldset data-role="controlgroup" data-type="horizontal" data-theme="b">
                <select id="shiftDDL">
                    <option>כיוון</option>
                    <option>בוקר</option>
                    <option>אחהצ</option>
                </select>
                <select id="dateDDL"></select>
                <select id="dayDDL">
                    <option>כל יום</option>
                    <option>א</option>
                    <option>ב</option>
                    <option>ג</option>
                    <option>ד</option>
                    <option>ה</option>
                    <option>ו</option>
                    <option>ש</option>
                </select>
            </fieldset>

            <fieldset data-role="controlgroup" data-type="horizontal" data-theme="b">
                <select id="endDDL">
                    <option>יעד</option>
                    <option>ארז</option>
                    <option>רמבם</option>
                    <option>ג'למה</option>
                    <option>אייל</option>
                    <option>שיבא</option>
                    <option>ירושלים</option>
                </select>
                <select id="startDDL">
                    <option>מוצא</option>
                    <option>ארז</option>
                    <option>רמבם</option>
                    <option>ג'למה</option>
                    <option>אייל</option>
                    <option>שיבא</option>
                    <option>ירושלים</option>
                </select>
                <select id="areaDDL">
                    <option>איזור</option>
                    <option>דרום</option>
                    <option>מרכז</option>
                    <option>צפון</option>
                </select>
            </fieldset>

            <ul id="pTarget" data-role="listview" data-inset="true" data-icon="false"></ul>
        </div>

        <div data-role="footer" data-theme="b">
            <h1>בדרך להחלמה</h1>
        </div>

    </div>

</body>
</html>